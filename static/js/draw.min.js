CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){r=Math.min(w/2,h/2,r);this.moveTo(x+r,y);this.lineTo(x+w-r,y);this.arc(x+w-r,y+r,r,Math.PI*1.5,Math.PI*2,false);this.lineTo(x+w,y+h-r);this.arc(x+w-r,y+h-r,r,0,Math.PI/2,false);this.lineTo(x+r,y+h);this.arc(x+r,y+h-r,r,Math.PI/2,Math.PI,false);this.lineTo(x,y+r);this.arc(x+r,y+r,r,Math.PI,Math.PI*1.5,false)};var returnAnalysisRst=null;$(document).ready(function(){var analysisBtn,analysis=null,readySentView=null,readyXmlView=null,readyParaView=null,maskObj=document.getElementById("mask"),manualObj=document.getElementById("usingManual"),loadingObj=document.getElementById("loadingTag"),loadingOriHtml=loadingObj.innerHTML,analysisPanelObj=document.getElementById("analysisPanel"),setLoadingPos=null,SELECT_SENTS={singleSentence:"我们即将以昂扬的斗志迎来新的一年。\n国内专家学者40余人参加研讨会。\n在家禽摊位中，有一个摊位专卖乌骨鸡。\n徐先生还具体帮助他确定了把画雄鹰、松鼠和麻雀作为主攻目标。",multipleSentence:"这是一个感人的故事，也是一个美丽的故事。\n他是山西省书法家协会会员，曾多次在国内各类书法大赛中获奖。\n我们每天下午放学后练习一个半小时，每周六再训练两个小时。\n潘秀云今年40岁，长得高高壮壮，人很能干。",paraPolity:"巴希尔强调，政府坚决主张通过和平和政治途径结束目前的武装冲突，在全国实现和平。他强烈呼吁以约翰·加朗为首的反政府武装力量回到国家的怀抱。在谈到周边关系时，巴希尔说，苏丹政府将采取行动改善与周边国家的关系。",paraSports:"大连万达俱乐部在决赛后，因对裁判员判罚不满，而拒绝领奖和不出席新闻发布会。这种行为不仅不符合体育精神，不符合足球比赛的规范，也有损于大连万达俱乐部和中国足球的形象。对此，中国足球协会特通报批评。大连万达俱乐部应认真检查，吸取教训，并准备接受亚足联可能给予的处罚。"},sentSelectDomObj=document.getElementById("sentSelect"),textareaEnterNum=0,getEnterNumFromStr=null,analysisBtn=$("#analysis");analysis=function(){var requestArgs=[],postData,targetURL;requestArgs["api_key"]="U2G658z15u6Q4RpksQHC9KDevunLIypIHc5nPr5U";requestArgs["pattern"]="all";requestArgs["format"]="json";requestArgs["text"]=encodeURI($("#inputText").val());postData=function(){var tmpStrArray=[];for(key in requestArgs){tmpStrArray.push([key,requestArgs[key]].join("="))}return tmpStrArray.join("&")}();targetURL="http://ltpapi.voicecloud.cn/analysis/";$.ajax({url:targetURL,type:"POST",async:true,dataType:"jsonp",data:postData,success:function(returnVal){returnAnalysisRst=returnVal;readySentView();readyXmlView(returnVal)},error:function(errorInfo){console.log(errorInfo);loadingObj.innerHTML=['<p class="text-error">',"发送分析请求失败！请点击<code>分析</code>重试.","</p>"].join("")}});maskObj.style.display="block";analysisPanel.style.display="none";manualObj.style.display="none";loadingObj.innerHTML=loadingOriHtml;loadingObj.style.display="block";setLoadingPos();return false};readySentView=function(){initDom(DRAW_PARENT_ID,returnAnalysisRst);maskObj.style.display="none";analysisPanel.style.display="block";$("#sent-tab").tab("show");lastOpenedEle=document.getElementById(DRAW_PARENT_ID).getElementsByTagName("DIV")[0];drawCanvas(lastOpenedEle);lastOpenedEle.parentNode.getElementsByTagName("CANVAS")[0].parentNode.style.height=CANVAS_HEIGHT+"px"};readyParaView=function(){selectParaPartToDrawByValue($("input[name=paraDisItem]:checked").val())};readyXmlView=function(returnJsonObj){var xmlDOM=LTPRstParseJSON2XMLDOM(returnJsonObj),str=parseXMLDOM2String(xmlDOM),formatedStr=formatDOMStrForDisplay(str);$("#xml_area").val(formatedStr)};setLoadingPos=function(){var parentNode=maskObj,pWidth=parentNode.offsetWidth,left;if(pWidth!=0){left=(pWidth-loadingObj.offsetWidth)/2;loadingObj.style.left=left+"px"}};getEnterNumFromStr=function(str){var enterNum=0,startPos=0;while(true){startPos=str.indexOf("\n",startPos);if(startPos!=-1){enterNum++;startPos++}else break}return enterNum};analysisBtn.bind("click",analysis);$("#viewTab a").click(function(e){e.preventDefault();$(this).tab("show");selectParaPartToDrawByValue($("input[name=paraDisItem]:checked").val())});$(sentSelectDomObj).bind("change",function(){$("#inputText").val(SELECT_SENTS[$(this).val()]);textareaEnterNum=getEnterNumFromStr(SELECT_SENTS[$(this).val()])});$("#load-local-xml-btn").bind("click",function(e){var localXML=parseString2XMLDOM($("#xml_area").val()),localJson=LTPRstParseXMLDOM2JSON(localXML);if(localJson!=[]&&localJson!=undefined){returnAnalysisRst=localJson;readySentView()}return false});$(window).bind("resize",function(e){if(demo!=null){demo.move(0,0)}setLoadingPos()});initNerIntro();$("#inputText").val(SELECT_SENTS[sentSelectDomObj.value]);textareaEnterNum=getEnterNumFromStr(SELECT_SENTS[sentSelectDomObj.value])});function Demo(canvasId){this.canvasId=canvasId;this.canvas=null;this.drawStruct=null;this.canvasBufs=null;this.imageData=null;this.undefined=undefined;this.offset={};this.eventModule={}}Demo.prototype={processNerNode:function(neVal,idx,drawStruct){if(neVal==undefined)return;var neValParts=neVal.toLowerCase().split("-");if(neValParts.length==2){switch(neValParts[0]){case"s":drawStruct.ner.push({neName:neValParts[1],startIdx:idx,endIdx:idx});break;case"b":drawStruct.ner.push({neName:neValParts[1],startIdx:idx});break;case"e":drawStruct.ner[drawStruct.ner.length-1]["endIdx"]=idx;break;default:}}},processSrlNode:function(idx,arg,drawStruct){if(arg.length==0)return;else{for(var i=0;i<arg.length;i++){arg[i]["beg"]=parseInt(arg[i]["beg"]);arg[i]["end"]=parseInt(arg[i]["end"]);arg[i]["id"]=parseInt(arg[i]["id"])}drawStruct.srl.push({idx:idx,arg:arg})}},initDrawStruct:function(sentObj){var canvas=document.createElement("canvas"),cxt=canvas.getContext("2d"),i,preTextWidth,curContPos;this.drawStruct={posInfo:[],texts:[],postag:[],ner:[],srl:[],dp:[],WS_INTERVAL:40,width:0,height:0,NER_DISCONF:{ni:{bgcolor:"#99ffff",cnName:"机构"},nh:{bgcolor:"#99ff99",cnName:"人名"},ns:{bgcolor:"#ccff66",cnName:"地名"}},SRL_DISCONF:{bgColor:"#ffec8b",lineColor:"#eeeeee",textColor:"#6f8ca0",lineWidth:5},DP_DISCONF:{lineColor:"blue",textColor:"red"}},this.offset={x:0,y:0},this.eventModule={startX:0,startY:0,hasDown:false};this.drawStruct.texts.push("Root");this.drawStruct.posInfo.push(0);this.drawStruct.postag.push("");cxt.save();this.setTextFont(cxt);for(i=0;i<sentObj.length;i++){preTextWidth=cxt.measureText(this.drawStruct.texts[i]).width;curContPos=this.drawStruct.posInfo[i]+preTextWidth+this.drawStruct.WS_INTERVAL;this.drawStruct.texts.push(sentObj[i].cont);this.drawStruct.posInfo.push(curContPos);this.drawStruct.postag.push(sentObj[i].pos);this.processNerNode(sentObj[i].ne,i+1,this.drawStruct);this.processSrlNode(i,sentObj[i]["arg"],this.drawStruct);this.drawStruct.dp.push({from:parseInt(sentObj[i].parent),to:parseInt(i),relate:sentObj[i].relate})}preTextWidth=cxt.measureText(this.drawStruct.texts[i]).width;curContPos=this.drawStruct.posInfo[i]+preTextWidth+this.drawStruct.WS_INTERVAL;this.drawStruct.posInfo.push(curContPos);this.drawStruct.width=curContPos;cxt.restore();canvas=null},setTextFont:function(cxt){cxt.font="12px Microsoft YaHei,SimSun,STSong"},setEnTextFont:function(cxt){cxt.font="12px Arial,Courier New"},setTextFillStyle:function(cxt){cxt.fillStyle="black"},getFontSizeFromFontstr:function getFontSizeFromFontstr(fontstr){var parts=fontstr.split(""),idx;for(var i=0;i<parts.length;i++){if((idx=parts[i].indexOf("px"))!=-1){return parts[i].slice(0,idx)}}return 12},getTextLineheightAndPaintHeight:function(fontSize){var verticalMargin,lineheight,paintHeight;verticalMargin=fontSize*.25;paintHeight=fontSize+2*verticalMargin;lineheight=fontSize+verticalMargin;return{lineheight:lineheight,paintHeight:paintHeight}},setCanvasAppropriateHeight:function(canvas,startY,height){var cxt=canvas.getContext("2d"),imageData;imageData=cxt.getImageData(0,startY,canvas.width,height);canvas.height=height;cxt.putImageData(imageData,0,0)},setOffset:function(x,y){this.offset.x+=x;this.offset.y+=y},createCanvasBuffer:function(w,h){var canvasBuf=document.createElement("canvas");canvasBuf.width=w;canvasBuf.height=h;return canvasBuf},drawWS:function(drawStruct){if(drawStruct.texts.length==0)return null;var canvas=this.createCanvasBuffer(5e3,100),cxt,i,heightObj;cxt=canvas.getContext("2d");cxt.save();this.setTextFont(cxt);this.setTextFillStyle(cxt);fontSize=this.getFontSizeFromFontstr(cxt.font);heightObj=this.getTextLineheightAndPaintHeight(fontSize);for(i=0;i<drawStruct.texts.length;i++){cxt.fillText(drawStruct.texts[i],drawStruct.posInfo[i],heightObj.lineheight)}cxt.restore();this.setCanvasAppropriateHeight(canvas,0,heightObj.paintHeight);return canvas},drawPOSTAG:function(drawStruct){if(drawStruct.postag.length==0)return null;var canvas=this.createCanvasBuffer(5e3,50),cxt,i,heightObj,fontSize;cxt=canvas.getContext("2d");cxt.save();this.setEnTextFont(cxt);this.setTextFillStyle(cxt);cxt.textAlign="center";fontSize=this.getFontSizeFromFontstr(cxt.font);heightObj=this.getTextLineheightAndPaintHeight(fontSize);for(i=1;i<drawStruct.postag.length;i++){var centerPos=(drawStruct.posInfo[i]+(drawStruct.posInfo[i+1]-drawStruct.WS_INTERVAL))/2;cxt.fillText(drawStruct.postag[i],centerPos,heightObj.lineheight)}cxt.restore();this.setCanvasAppropriateHeight(canvas,0,heightObj.paintHeight);return canvas},drawNerNode:function(nerNode,drawStruct,cxt){var bgColor,cnNeName,color="#000000",paintX,paintY=0,paintWidth,paintHeight=16,confSet=drawStruct.NER_DISCONF,fontSize,fontBaselineHeight,fontX;cxt.beginPath();bgColor=confSet[nerNode.neName]==undefined?"#0099cc":confSet[nerNode.neName].bgcolor;cnNeName=confSet[nerNode.neName]==undefined?"实体名":confSet[nerNode.neName].cnName;cxt.fillStyle=bgColor;paintX=drawStruct.posInfo[nerNode.startIdx]-drawStruct.WS_INTERVAL/2;paintWidth=drawStruct.posInfo[nerNode.endIdx+1]-drawStruct.posInfo[nerNode.startIdx];cxt.fillRect(paintX,paintY,paintWidth,paintHeight);this.setTextFillStyle(cxt);this.setTextFont(cxt);fontSize=this.getFontSizeFromFontstr(cxt.font);fontBaselineHeight=paintY+fontSize;fontX=paintX+paintWidth/2;cxt.textAlign="center";cxt.fillText(cnNeName,fontX,fontBaselineHeight);return paintY+paintHeight},drawNER:function(drawStruct){if(drawStruct.ner.length==0)return null;var canvas=this.createCanvasBuffer(5e3,50),cxt=canvas.getContext("2d"),i,height;cxt.save();for(i=0;i<drawStruct.ner.length;i++){height=this.drawNerNode(drawStruct.ner[i],drawStruct,cxt)}cxt.restore();this.setCanvasAppropriateHeight(canvas,0,height);return canvas},drawSrlNode:function drawSrlNode(drawIdx,srlNode,drawStruct,cxt){var lineStartPos,lineEndPos,startIdx,endIdx,lineY,textX,textY,paintY,paintHeight=16,paintInterval=4,roundRectRadius=6,paintX,argLen=srlNode.arg.length;paintY=drawIdx*(paintHeight+paintInterval);cxt.save();startIdx=srlNode.idx<srlNode.arg[0].beg?srlNode.idx:srlNode.arg[0].beg;lineStartPos=drawStruct.posInfo[startIdx+1]-drawStruct.WS_INTERVAL/2;endIdx=srlNode.idx>srlNode.arg[argLen-1].end?srlNode.idx:srlNode.arg[argLen-1].end;lineEndPos=drawStruct.posInfo[endIdx+1+1]-drawStruct.WS_INTERVAL/2;lineY=paintY+paintHeight-drawStruct.SRL_DISCONF.lineWidth;cxt.strokeStyle=drawStruct.SRL_DISCONF.lineColor;cxt.lineWidth=drawStruct.SRL_DISCONF.lineWidth;cxt.beginPath();cxt.moveTo(lineStartPos,lineY);cxt.lineTo(lineEndPos,lineY);cxt.closePath();cxt.stroke();cxt.restore();cxt.fillStyle=drawStruct.SRL_DISCONF.textColor;cxt.textAlign="center";this.setTextFont(cxt);textX=(drawStruct.posInfo[srlNode.idx+1]+drawStruct.posInfo[srlNode.idx+1+1]-drawStruct.WS_INTERVAL)/2;textY=paintY+this.getFontSizeFromFontstr(cxt.font);cxt.fillText(drawStruct.texts[srlNode.idx+1],textX,textY);this.setEnTextFont(cxt);for(var i=0;i<argLen;i++){cxt.fillStyle=drawStruct.SRL_DISCONF.bgColor;var x=drawStruct.posInfo[srlNode.arg[i].beg+1]-drawStruct.WS_INTERVAL/2,y=paintY,w=drawStruct.posInfo[srlNode.arg[i].end+1+1]-drawStruct.posInfo[srlNode.arg[i].beg+1],h=paintHeight;cxt.beginPath();cxt.roundRect(x,y,w,h,roundRectRadius);cxt.closePath();cxt.fill();this.setTextFillStyle(cxt);cxt.fillText(srlNode.arg[i].type.toUpperCase(),x+w/2,textY)}return paintY+paintHeight},drawSRL:function(drawStruct){if(drawStruct.srl.length==0)return null;var canvas=this.createCanvasBuffer(5e3,400),cxt=canvas.getContext("2d"),i,height;cxt.save();for(i=0;i<drawStruct.srl.length;i++){height=this.drawSrlNode(i,drawStruct.srl[i],drawStruct,cxt)}cxt.restore();this.setCanvasAppropriateHeight(canvas,0,height);return canvas},drawDpNode:function(dpNode,drawStruct,cxt){var fromCenter,fromX,toCenter,lineInterval=7,arrowHeight=7,arrowWidth=5,arrowDownOffset=2,arrowLeftOffset,paintY=cxt.canvas.height,controlPointHeight,controlPointY,lineY=paintY-arrowDownOffset,actualY;fromCenter=(drawStruct.posInfo[dpNode.from+1]+drawStruct.posInfo[dpNode.from+1+1]-drawStruct.WS_INTERVAL)/2;toCenter=(drawStruct.posInfo[dpNode.to+1]+drawStruct.posInfo[dpNode.to+1+1]-drawStruct.WS_INTERVAL)/2;fromX=fromCenter<toCenter?fromCenter+lineInterval:fromCenter-lineInterval;controlPointHeight=Math.abs(dpNode.to-dpNode.from)*13+10;controlPointY=lineY-controlPointHeight;actualY=lineY-controlPointHeight*3/4;cxt.strokeStyle=drawStruct.DP_DISCONF.lineColor;cxt.beginPath();cxt.moveTo(fromX,lineY);cxt.bezierCurveTo(fromX,controlPointY,toCenter,controlPointY,toCenter,lineY);cxt.stroke();cxt.closePath();arrowLeftOffset=dpNode.to>dpNode.from?(arrowWidth-cxt.lineWidth)/2+1:(arrowWidth-cxt.lineWidth)/2-1;cxt.beginPath();cxt.moveTo(toCenter,paintY);cxt.lineTo(toCenter-arrowLeftOffset,paintY-arrowHeight);cxt.lineTo(toCenter+(arrowWidth-arrowLeftOffset),paintY-arrowHeight);cxt.closePath();cxt.fillStyle=drawStruct.DP_DISCONF.lineColor;cxt.fill();cxt.fillStyle=drawStruct.DP_DISCONF.textColor;cxt.textAlign="center";this.setEnTextFont(cxt);cxt.fillText(dpNode.relate,(fromX+toCenter)/2,actualY+this.getFontSizeFromFontstr(cxt.font)/2);return actualY},drawDP:function(drawStruct){if(drawStruct.dp.length==0)return null;var canvas=this.createCanvasBuffer(5e3,5e3),cxt=canvas.getContext("2d"),i,minY=canvas.height,newHeight;cxt.lineWidth=.6;for(i=0;i<drawStruct.dp.length;i++){yPos=this.drawDpNode(drawStruct.dp[i],drawStruct,cxt);if(minY>yPos)minY=yPos}minY-=10;newHeight=canvas.height-minY;this.setCanvasAppropriateHeight(canvas,minY,newHeight);return canvas},drawComponent:function(drawStruct){var WSCanvas,POSTAGCanvas,NERCanvas,SRLCanvas,DPCanvas;this.canvasBufs={};WSCanvas=this.drawWS(drawStruct);POSTAGCanvas=this.drawPOSTAG(drawStruct);NERCanvas=this.drawNER(drawStruct);SRLCanvas=this.drawSRL(drawStruct);DPCanvas=this.drawDP(drawStruct);this.canvasBufs["WS"]=WSCanvas;this.canvasBufs["POSTAG"]=POSTAGCanvas;this.canvasBufs["NER"]=NERCanvas;this.canvasBufs["SRL"]=SRLCanvas;this.canvasBufs["DP"]=DPCanvas;return this.canvasBufs},drawContainer:function(drawStruct,canvasBufs,disableAttr){var canvas=document.createElement("canvas");canvas.width=drawStruct.width;canvas.height=5e3;var cxt=canvas.getContext("2d"),drawBufs={WS:null,POSTAG:null,NER:null,DP:null,SRL:null},offsetX=0,offsetY=0,intervalY=10,paintY=offsetY,drawTarget;if(typeof disableAttr=="undefined"||disableAttr==null)disableAttr={};for(key in drawBufs){drawBufs[key]=canvasBufs[key]===undefined||disableAttr[key]==true?"disable":canvasBufs[key]}cxt.clearRect(0,0,canvas.width,canvas.height);drawTarget=["DP","WS","POSTAG","NER","SRL"];for(var i=0;i<drawTarget.length;i++){var drawCanvas=drawBufs[drawTarget[i]];if(typeof drawCanvas=="string"&&drawCanvas=="disable")continue;else if(drawCanvas==null)paintY+=3*intervalY;else{cxt.drawImage(drawCanvas,offsetX,paintY);paintY+=intervalY+drawCanvas.height}}if(drawBufs["DP"]==null||drawBufs["DP"]=="disable"){cxt.clearRect(0,0,drawStruct.posInfo[1]-drawStruct.WS_INTERVAL,paintY)}this.setCanvasAppropriateHeight(canvas,0,paintY);this.drawStruct.height=paintY;this.imageData=cxt.getImageData(0,0,canvas.width,canvas.height);return this.imageData},drawView:function(imageData,canvas,x,y){this.canvas=document.getElementById(this.canvasId);if(this.canvas==null)return;var cxt=canvas.getContext("2d");cxt.clearRect(0,0,canvas.width,canvas.height);cxt.putImageData(imageData,x,y)},analysis:function(sentObj){this.initDrawStruct(sentObj);this.drawComponent(this.drawStruct)},update:function(disableAttr){this.drawContainer(this.drawStruct,this.canvasBufs,disableAttr);this.move(0,0)},paint:function(){this.update()},move:function(offsetX,offsetY){this.drawView(this.imageData,this.canvas,this.offset.x+offsetX,this.offset.y+offsetY)},addaptWidth:function(){this.canvas=document.getElementById(this.canvasId);if(this.canvas==null)return;var parent=this.canvas.parentNode;if(parent.offsetWidth==0)return;this.canvas.width=parent.offsetWidth;this.canvas.height=500},downAction:function(e){if(e.target.tagName=="CANVAS"){this.eventModule.startX=e.pageX;this.eventModule.startY=e.pageY;this.eventModule.hasDown=true;e.target.style.cursor="move"}},upAction:function(e){if(this.eventModule.hasDown==true){var x=e.pageX-this.eventModule.startX,y=e.pageY-this.eventModule.startY;this.setOffset(x,y);this.eventModule.startX=e.pageX;this.eventModule.startY=e.pageY;this.eventModule.hasDown=false;e.target.style.cursor="default"}},moveAction:function(e){if(this.eventModule.hasDown==true){var offsetX=e.pageX-this.eventModule.startX,offsetY=e.pageY-this.eventModule.startY;this.move(offsetX,offsetY)}}};var paraSelectAction=null,drawParaOriginWord=null,drawParaWS=null,drawParaPostag=null,drawParaNer=null,paraDrawObj=null,paraNerIntroDomObj=document.getElementById("paraNerIntro"),setNerIntroDis=null,initNerIntro=null,selectParaPartToDrawByValue=null,nerMap=null,lastSelectedValue="para-ws",DRAW_PARA_PARENT_ID="paraContent",PARA_SELECT_PANEL_ID="paraSelPanel";paraDrawObj=document.getElementById(DRAW_PARA_PARENT_ID);nerMap={Ni:{color:"#00008b",cnName:"机构名"},Nh:{color:"#cda000",cnName:"人名"},Ns:{color:"#3c8c71",cnName:"地名"}};drawParaOriginWord=function(parentObj,sentsObj){var sentDom=document.createElement("P");for(var i=0;i<sentsObj.length;i++){var paraCont=[],sentCopy=sentDom.cloneNode(false);for(var j=0;j<sentsObj[i].length;j++){paraCont.push(getSentent(sentsObj[i][j]))}sentCopy.innerHTML=paraCont.join("");parentObj.appendChild(sentCopy)}};drawParaWS=function(parentObj,sentsObj){var sentDom=document.createElement("P");for(var i=0;i<sentsObj.length;i++){var paraCont=[],sentCopy=sentDom.cloneNode(false);for(var j=0;j<sentsObj[i].length;j++){for(var k=0;k<sentsObj[i][j].length;k++){paraCont.push(sentsObj[i][j][k].cont)}}sentCopy.innerHTML=paraCont.join("&nbsp;&nbsp;");parentObj.appendChild(sentCopy)}};drawParaPostag=function(parentObj,sentsObj){var POSTAG_COLOR="#8b00b2",postag_style_start='<span style="color:'+POSTAG_COLOR+';">',postag_style_end="</span>",sentDom=document.createElement("P");for(var i=0;i<sentsObj.length;i++){var paraCont=[],sentCopy=sentDom.cloneNode(false);for(var j=0;j<sentsObj[i].length;j++){for(var k=0;k<sentsObj[i][j].length;k++){paraCont.push([sentsObj[i][j][k].cont,"/",postag_style_start,sentsObj[i][j][k].pos,postag_style_end].join(""))}}sentCopy.innerHTML=paraCont.join("&nbsp;&nbsp;");parentObj.appendChild(sentCopy)}};drawParaNer=function(parentObj,sentsObj){var sentDom=document.createElement("P");for(var i=0;i<sentsObj.length;i++){var paraCont=[],sentCopy=sentDom.cloneNode(false);for(var j=0;j<sentsObj[i].length;j++){for(var k=0;k<sentsObj[i][j].length;k++){var nerVal=sentsObj[i][j][k].ne,nerMatch=nerVal.match(/^(\w+)?-(\w+)$/);if(nerMatch!=null&&nerMatch.length==3){var tag=nerMatch[1],nerType=nerMatch[2],style_start='<span style="color : '+nerMap[nerType].color+';">',style_end="</span>";switch(tag){case"S":paraCont.push([style_start,sentsObj[i][j][k].cont,style_end].join(""));break;case"B":paraCont.push([style_start,sentsObj[i][j][k].cont].join(""));break;case"M":paraCont.push(sentsObj[i][j][k].cont);break;case"E":paraCont.push([sentsObj[i][j][k].cont,style_end].join(""));break}}else{paraCont.push(sentsObj[i][j][k].cont)}}}sentCopy.innerHTML=paraCont.join("");parentObj.appendChild(sentCopy)}};setNerIntroDis=function(isToDis){if(isToDis==true||isToDis===undefined){var wrapper=paraNerIntroDomObj.parentNode,wrapperHeight=wrapper.offsetHeight,paraContentHeight=paraDrawObj.offsetHeight,introHeight=(paraNerIntroDomObj.currentStyle||document.defaultView.getComputedStyle(paraNerIntroDomObj,false))["height"].slice(0,-2),whiteHeight=wrapperHeight-paraContentHeight;if(whiteHeight>introHeight){var marginTopVal=whiteHeight-introHeight;paraNerIntroDomObj.style.marginTop=marginTopVal+"px";paraNerIntroDomObj.style.display="block"}else{paraNerIntroDomObj.style.marginTop="0px";paraNerIntroDomObj.style.display="block"}}else{paraNerIntroDomObj.style.display="none"}};initNerIntro=function(){for(var key in nerMap){var introItem=document.createElement("LABEL"),box=document.createElement("SPAN"),textNode=document.createTextNode([nerMap[key].cnName,"(",key,")"].join(""));box.style.background=nerMap[key].color;box.setAttribute("class","box");introItem.appendChild(box);introItem.appendChild(textNode);introItem.setAttribute("class","inline");paraNerIntroDomObj.appendChild(introItem)}};selectParaPartToDrawByValue=function(paraValue){while(paraDrawObj.lastChild!=null)paraDrawObj.removeChild(paraDrawObj.lastChild);switch(paraValue){case"para-originWord":drawParaOriginWord(paraDrawObj,returnAnalysisRst);setNerIntroDis(false);break;case"para-ws":drawParaWS(paraDrawObj,returnAnalysisRst);setNerIntroDis(false);break;case"para-postag":drawParaPostag(paraDrawObj,returnAnalysisRst);setNerIntroDis(false);break;case"para-ner":drawParaNer(paraDrawObj,returnAnalysisRst);setNerIntroDis(true);break}};paraSelectAction=function(e){if(e.target.type=="radio"){if(lastSelectedValue==e.target.value)return false;lastSelectedValue=e.target.value;selectParaPartToDrawByValue(e.target.value)}};$(document).ready(function(){$("#"+PARA_SELECT_PANEL_ID).bind("click",function(e){paraSelectAction(e)})});var lastOpenedEle=null,intervalId,getCanvasContainerFromParentSibling=null,getSentent=null,initDom=null,drawCanvas=null,switchCanvas=null,changeDisObj=null,disableAttr=null,setDisableAttr=null,demo=null,DRAW_CANVAS_ID="canvasTest",DRAW_PARENT_ID="analysisContent",DISABLE_ATTR_PANEL_ID="disableAttrPanel",CANVAS_HEIGHT=500,demo=new Demo(DRAW_CANVAS_ID);changeDisObj=function(newObj,previousObj){var stepLen=50,newObjOriHeight=newObj.offsetHeight,previousObjOriHeight=previousObj.offsetHeight;newObj.style.height=stepLen+newObjOriHeight+"px";previousObj.style.height=previousObjOriHeight-stepLen+"px";if(previousObj.offsetHeight<=0){clearInterval(intervalId)}};getCanvasContainerFromParentSibling=function(parentSibling){return parentSibling.parentNode.getElementsByTagName("CANVAS")[0].parentNode};getSentent=function(sentEle){var wsList=[],enReg=/^[A-Za-z']*$/;for(var i=0;i<sentEle.length;i++){wsList.push(sentEle[i].cont);if(enReg.test(sentEle[i].cont)&&i<sentEle.length-1&&enReg.test(sentEle[i+1].cont)){wsList.push(" ")}}return wsList.join("")};initDom=function(parentId,sentsObj){var parentContainer=document.getElementById(parentId),liEle=document.createElement("LI"),itemDivEle=document.createElement("DIV"),canvasDivEle=document.createElement("DIV"),canvasEle=document.createElement("CANVAS"),eleCopy;while(parentContainer.childNodes.length>0)parentContainer.removeChild(parentContainer.lastChild);itemDivEle.setAttribute("class","text-item");canvasDivEle.setAttribute("class","canvasContainer");canvasDivEle.appendChild(canvasEle);liEle.appendChild(itemDivEle);liEle.appendChild(canvasDivEle);for(var i=0;i<sentsObj.length;i++){for(var j=0;j<sentsObj[i].length;j++){eleCopy=liEle.cloneNode(true);eleCopy.firstChild.setAttribute("x",i),eleCopy.firstChild.setAttribute("y",j);var sentent=getSentent(sentsObj[i][j]);var textNode=document.createTextNode(["段落",i+1,"句子",j+1,":",sentent].join(""));eleCopy.firstChild.appendChild(textNode);parentContainer.appendChild(eleCopy)}}};drawCanvas=function(itemDivEle){var i=itemDivEle.getAttribute("x"),j=itemDivEle.getAttribute("y");if(lastOpenedEle!=itemDivEle)lastOpenedEle.parentNode.getElementsByTagName("CANVAS")[0].setAttribute("id","");itemDivEle.parentNode.getElementsByTagName("CANVAS")[0].setAttribute("id",DRAW_CANVAS_ID);demo.addaptWidth();demo.analysis(returnAnalysisRst[i][j]);demo.update(disableAttr)};switchCanvas=function(clickedItemDivEle,previousClickedItemDivEle){if(clickedItemDivEle!=previousClickedItemDivEle){var clickedCanvasContainer=getCanvasContainerFromParentSibling(clickedItemDivEle),previousCanvasContainer=getCanvasContainerFromParentSibling(previousClickedItemDivEle);intervalId=setInterval(function(){changeDisObj(clickedCanvasContainer,previousCanvasContainer)},10)}};setDisableAttr=function(panelId){var panel=document.getElementById(panelId),checkboxList=panel.getElementsByTagName("INPUT");disableAttr={};for(var i=0;i<checkboxList.length;i++){if(checkboxList[i].type=="checkbox"&&checkboxList[i].checked==false){var value=checkboxList[i].value,key=value.match(/[^-]*/)[0].toUpperCase();disableAttr[key]=true}}};$(document).ready(function(){$("#"+DISABLE_ATTR_PANEL_ID).bind("click",function(e){setDisableAttr(DISABLE_ATTR_PANEL_ID);demo.update(disableAttr)});$("#"+DRAW_PARENT_ID).bind({mousedown:function(e){demo.downAction(e)},mouseup:function(e){demo.upAction(e)},mousemove:function(e){demo.moveAction(e)}});$("#"+DRAW_PARENT_ID).bind("click",function(e){var ele=e.target;if(lastOpenedEle!=null&&ele.getAttribute("class")=="text-item"&&ele!=lastOpenedEle){drawCanvas(ele);(function(previousClicked){switchCanvas(ele,previousClicked)})(lastOpenedEle);lastOpenedEle=ele}})});function createXMLDOM(){if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLDOM")}else if(document.implementation&&document.implementation.createDocument){return document.implementation.createDocument("","",null)}else return null}function parseXMLDOM2String(xmlDOM){if(window.ActiveXObject){return xmlDOM.xml}else if(document.implementation&&document.implementation.createDocument){return(new XMLSerializer).serializeToString(xmlDOM)}else return""}function parseString2XMLDOM(xmlStr){var parser=new DOMParser;if(!parser)return"";return parser.parseFromString(xmlStr,"text/xml")}function getDocElement(xmlDOM,JsonData){var doc=xmlDOM.createElement("doc");for(var paraId=0;paraId<JsonData.length;paraId++){var JsonPara=JsonData[paraId],para=xmlDOM.createElement("para");para.setAttribute("id",paraId);doc.appendChild(para);for(var sentId=0;sentId<JsonPara.length;sentId++){var JsonSent=JsonPara[sentId],sent=xmlDOM.createElement("sent"),contArray=[];sent.setAttribute("id",sentId);para.appendChild(sent);for(var wordId=0;wordId<JsonSent.length;wordId++){var JsonWord=JsonSent[wordId],word=xmlDOM.createElement("word");sent.appendChild(word);word.setAttribute("id",JsonWord.id);word.setAttribute("cont",JsonWord.cont);word.setAttribute("pos",JsonWord.pos);word.setAttribute("ne",JsonWord.ne);word.setAttribute("parent",JsonWord.parent);word.setAttribute("relate",JsonWord.relate);for(var argId=0;argId<JsonWord.arg.length;argId++){var JsonArg=JsonWord.arg[argId],arg=xmlDOM.createElement("arg");word.appendChild(arg);arg.setAttribute("id",JsonArg.id);arg.setAttribute("type",JsonArg.type);arg.setAttribute("beg",JsonArg.beg);arg.setAttribute("end",JsonArg.end)}contArray.push(JsonWord.cont)}var contStr="";for(var i=0;i<contArray.length;i++){if(i==0){contStr+=contArray[i]}else{var enCharReg=/[a-zA-Z]/,lastChar=contArray[i-1].slice(-1),firstChar=contArray[i].slice(0);if(enCharReg.test(lastChar)&&enCharReg.test(firstChar)){contStr+=" "}contStr+=contArray[i]}}sent.setAttribute("cont",contStr)}}return doc}function LTPRstParseJSON2XMLDOM(jsonData){var xmlDOM=createXMLDOM();if(xmlDOM==null)return null;var root=xmlDOM.createElement("xml4nlp"),note=xmlDOM.createElement("note"),noteAttr={sent:"y",word:"y",pos:"y",ne:"y",wsd:"y",srl:"y"};for(var attr in noteAttr){note.setAttribute(attr,noteAttr[attr])}root.appendChild(note);root.appendChild(getDocElement(xmlDOM,jsonData));return root}function formatDOMStrForDisplay(str){var formatedStr="",startPos=0,nextLineIndent=0,curLineIndent=0,tmpStr="",indentStr="",xmlHeader='<?xml version="1.0" encoding="utf-8" ?>';for(var i=0;i<str.length;i++){switch(str.charAt(i)){case"<":if(i+1<str.length&&str.charAt(i+1)=="/"){curLineIndent--;break}nextLineIndent++;break;case"/":nextLineIndent--;break;case">":tmpStr=str.slice(startPos,i+1);startPos=i+1;indentStr=function(){var tmpIndentStr="";for(var k=0;k<curLineIndent;k++){tmpIndentStr+="	"}return tmpIndentStr}();formatedStr+=indentStr+tmpStr+"\n";curLineIndent=nextLineIndent;break;default:break}}return xmlHeader+"\n"+formatedStr}function getDocJSON(docXML){var rst=[],paras=docXML.getElementsByTagName("para");for(var paraIdx=0;paraIdx<paras.length;paraIdx++){var para=paras[paraIdx],paraJSON=[],sents=para.getElementsByTagName("sent");rst.push(paraJSON);for(var sentIdx=0;sentIdx<sents.length;sentIdx++){var sent=sents[sentIdx],sentJSON=[],words=sent.getElementsByTagName("word");paraJSON.push(sentJSON);for(var wordIdx=0;wordIdx<words.length;wordIdx++){var word=words[wordIdx],wordJSON={},argList=[],args=word.getElementsByTagName("arg");sentJSON.push(wordJSON);for(var argIdx=0;argIdx<args.length;argIdx++){var arg=args[argIdx],argJSON={};argJSON["id"]=arg.getAttribute("id");argJSON["type"]=arg.getAttribute("type");argJSON["beg"]=arg.getAttribute("beg");argJSON["end"]=arg.getAttribute("end");argList.push(argJSON)}wordJSON["arg"]=argList;var attrList=["id","cont","pos","ne","parent","relate"];for(var i=0;i<attrList.length;i++){wordJSON[attrList[i]]=word.getAttribute(attrList[i])}}}}return rst}function LTPRstParseXMLDOM2JSON(xmlDOM){var doc=xmlDOM.getElementsByTagName("doc")[0];return getDocJSON(doc)}